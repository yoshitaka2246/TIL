# AWS IAM
AWS IAMは、**誰が、**、**どのAWSサービスやリソースに対して**、**何ができるか**を安全に管理するためのサービスです。
簡単に言えば、AWSのセキュリティとアクセス制御の中心となるものです。

## 認証と認可
IAMの役割は、**認証**と**認可**に大きくわけられます。
1. **認証(Authentication)**:**「あなたは本当に本人ですか？」**を確認する仕組みです。ユーザー名とパスワードのセットや、APIなどの場合はアクセスキーを用いて認証します。
2. **認可(Authorizarion)**:**「あなたはこれを行う権限がありますか？**を確認する仕組みです。認証を行った後、実際に行う行為について権限があるかどうかを確認します。

IAMはこの認証と認可の両方を管理し、**適切なユーザーに適切な権限のみを与える**ことを可能にします。

## IAMの主要な構成要素
IAMを理解するには以下の4つの主要な要素を理解することが必要です。
### 1.IAMユーザー
AWSアカウントに作成する**永続的なID**です。主に**人**や**特定のアプリケーション**を表します。
- **ログインパスワード**や**アクセスキー**を持ちます。
- セキュリティの観点から、日常的な作業はルートユーザーではなく**管理者権限をもつIAMユーザー**を作成して使用することが推奨されています。
- **ルートユーザー**は、AWSアカウントの作成時に作られるユーザーで、アカウントに対するすべての権限を持ちます。非常に強力な権限を持つため、日常的な利用は避けて厳重に管理することが必要です。

### 2.IAMグループ
複数のIAMユーザーをまとめる**入れ物**です。グループ自体にはパスワードなどはありません。
同じ役割を持つユーザーをグループに入れ、**グループに対して権限を割り当てる**ことで、ここのユーザーに設定する手間を省くことができます。

### 3.IAMポリシー
**実際に何ができるか**を具体的に定義したJSON形式のドキュメントです。ユーザー、グループ、ロールにアタッチすることで、それらの要素に権限を付与します。<br>
**ポリシーの構造**
```JSON
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::my-example-bucket/*"
    },
    {
      "Effect": "Deny",
      "Action": "s3:DeleteObject",
      "Resource": "arn:aws:s3:::my-example-bucket/secrets/*"
    }
  ]
}
```
- **Version**:ポリシーの書式バージョンで、**常に`"2012-10-17"`を使う**のが推奨されている。
- **Statement**:**実際の許可ルールを定義する配列**で、複数のオブジェクトを含むことができる。
- **Sid**:各ステートメントにつける識別子で、つけてもつけなくても良い。
- **Effect**:許可か拒否か(`"Allow"`か`"Deny"`)を設定する。基本ルールとして、**明示的に許可されていない操作は、すべてデフォルトで拒否**されているため、IAMポリシーでは`Allow`を指定していくことになる。
- **Action**:許可する具体的な操作。`"s3:PutObject"`など。ワイルドカード`*`が使える。
- **Resource**:権限を適用するAWSリソースを指定。`"arn:aws:s3:::bucket-name/*"`などのように指定。

### IAMロール
人ではなく、**AWSのサービスや他のアカウント**がAWSリソースにアクセスするために**一時的に引き受ける**権限です。
IAMユーザーのような永続的な認証情報は持たず、必要なときに**一時的なセキュリティ認証情報**を取得して使用します。
- EC2インスタンスからS3バケットにアクセスしたい場合、EC2にAIMロールをアタッチします。
- 自分のAWSアカウントのユーザーが、別のAWSアカウントのリソースにアクセスしたい場合
- など。

## 実務で気をつけること
1. 最小権限の原則
   S3からファイルを読み取るだけなら、`s3:GetObject`だけを許可し、`s3:DeleteObject`は許可しないなど、**「タスクを実行するために必要な最小限のアクセス許可のみを付与する」**というセキュリティの基本原則です。
   必要以上の権限を付与すると、万が一認証情報が漏洩した場合の被害範囲が甚大になります。
2. 認証情報の管理
   1. **多要素認証(MFA)の必須化**:ルートユーザーはもちろん、すべてのIAMユーザーにMFAを強制し、セキュリティを大幅に強化します。
   2. **アクセスキーのローテーション**:APIやCLIで使うアクセスキーを定期的に変更し、漏洩リスクを低減します。
3. グループとロールの使用
   1. **ポリシーはグループにアタッチ**:個々のユーザーではなく**IAMグループ**にポリシーをアタッチすることで、権限管理を一元化し、設定ミスを防ぎます。
   2. **IAMロールの活用**:アプリケーションやAWSサービスがリソースにアクセスする際は、**アクセスキーを埋め込むのではなく、必ずIAMロールを使用**します。これはセキュリティ上の最重要事項です。
4. AWS管理ポリシーvsカスタマー管理ポリシー
   1. **AWS管理ポリシー**:AWSが用意した`AmazonS3ReadOnlyAccess`などの便利なポリシーのことです。手軽ですが、権限が広すぎることがあるため本番環境では注意が必要です。
   2. **カスタマー管理ポリシー**:自分でJSONを記述して作成するポリシーのことで、**最小権限の原則**を徹底するため、実務ではこちらを作成することが多いです。

## まとめ
ここまでAWS IAMについて詳しく見てきました。IAMは単なるユーザー管理サービスではなく、セキュリティとアクセス制御の心臓部であることがわかると思います。IAMを正しく理解し、AWSリソースを安全かつ効率的に運用するための基盤を構築していきましょう。